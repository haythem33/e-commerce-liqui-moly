<div class="checkout block mt-5" *ngIf="user">
    <div class="container container--max--xl">
        <mat-stepper [linear]="true" #checkoutStepper [orientation]="(stepperOrientation | async)!">
            <mat-step [editable]="!stepsComplete.step3" [completed]="stepsComplete.step1">
                <ng-template matStepLabel>Détails de la facturation</ng-template>
                <div class="row">
                    <div class="col-12 col-lg-6 col-xl-7">
                        <div class="card mb-lg-0">
                            <div class="card-body profile-card__body">
                                <div class="profile-card__avatar">
                                    <img [src]="user.photoURL === 'DEFAULT' ? '../../../assets/images/default_user.png' : user.photoURL" alt="">
                                </div>
                                <div class="profile-card__name">{{user.displayName}}</div>
                                <div class="dashboard__address card address-card address-card--featured">
                                    <div class="address-card__badge tag-badge" style="background-color:#3f51b5;color:white">Adresse
                                    </div>
                                    <div class="address-card__body">
                                        <div class="address-card__name">{{user.adresse.state}}</div>
                                        <div class="address-card__row">{{user.adresse.city}} {{user.adresse.street}}
                                        </div>
                                        <div class="address-card__row">
                                            <div class="address-card__row-title">Numéro de téléphone</div>
                                            <div class="address-card__row-content">{{user.phoneNumber}}</div>
                                        </div>
                                        <div class="address-card__row">
                                            <div class="address-card__row-title">Adresse e-mail</div>
                                            <div class="address-card__row-content">{{user.email}}</div>
                                        </div>
                                        <div class="address-card__footer">
                                            <button mat-button color="primary" (click)="editAdress()">
                                                Modifier l'adresse
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6 col-xl-5 mt-4 mt-lg-0">
                        <div class="card mb-0">
                            <div class="card-body card-body--padding--2">
                                <h3 class="card-title">Votre commande</h3>
                                <table class="checkout__totals">
                                    <thead class="checkout__totals-header">
                                        <tr>
                                            <th>Produit</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody class="checkout__totals-products">
                                        <tr *ngFor="let cart of cart_list">
                                            <td>{{cart.car_part.name}} × {{cart.quantity}}</td>
                                            <td>{{cart.car_part.price * cart.quantity|number:'2.2'}}TND </td>
                                        </tr>
                                    </tbody>
                                    <tbody class="checkout__totals-subtotals">
                                        <tr>
                                            <th>Sous Total</th>
                                            <td>{{totalPrice|number:'2.2'}}TND</td>
                                        </tr>
                                        <tr>
                                            <th>Expédition</th>
                                            <td>0 TND</td>
                                        </tr>
                                        <tr>
                                            <th>Taux TVA</th>
                                            <td>20%</td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="checkout__totals-footer">
                                        <tr>
                                            <th>Total TTC</th>
                                            <td>{{totalPrice * 1.20|number:'2.2'}}TND</td>
                                        </tr>
                                    </tfoot>
                                </table>
                                <button type="submit" mat-button class="btn btn-lg btn-block" style="background-color:#3f51b5;color:white" (click)="nextStep(1)">
                                    Passer la commande
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-step>
            <mat-step [editable]="!stepsComplete.step3" [completed]="stepsComplete.step2">
                <ng-template matStepLabel>Méthode de paiement</ng-template>
                <div class="checkout__payment-methods payment-methods" style="min-height: 500px;">
                    <ul class="payment-methods__list">
                        <li class="payment-methods__item payment-methods__item--active m-2">
                            <label class="payment-methods__item-header">
                                <span class="payment-methods__item-radio input-radio">
                                    <span class="input-radio__body">
                                        <mat-checkbox [checked]="paymentMethode.bankTransfer"
                                            [disabled]="paymentMethode.bankTransfer" (change)="chosePayment(0)"
                                            color="primary">
                                        </mat-checkbox>
                                    </span>
                                </span>
                                <span class="payment-methods__item-title">Virement bancaire direct</span>
                            </label>
                            <div class="payment-methods__item-container">
                                <div class="payment-methods__item-details text-muted">Effectuez votre paiement directement sur notre compte bancaire. Votre commande ne sera pas expédiée tant que les fonds n'auront pas été crédités sur notre compte.
                                </div>
                            </div>
                        </li>
                        <li class="payment-methods__item payment-methods__item--active m-2">
                            <label class="payment-methods__item-header">
                                <span class="payment-methods__item-radio input-radio">
                                    <span class="input-radio__body">
                                        <mat-checkbox [checked]="paymentMethode.PayWithDeleviry"
                                            [disabled]="paymentMethode.PayWithDeleviry" (change)="chosePayment(1)"
                                            color="primary">
                                        </mat-checkbox>
                                    </span>
                                </span>
                                <span class="payment-methods__item-title">Paiement à la livraison</span>
                            </label>
                            <div class="payment-methods__item-container">
                                <div class="payment-methods__item-details text-muted">Payez en espèces à la livraison.
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div class="text-center m-4">
                        <button type="submit" mat-button class="btn btn-lg btn-block" style="background-color: #3f51b5;color:white" (click)="nextStep(2)">Suivant</button>
                    </div>
                </div>
            </mat-step>
            <mat-step [editable]="false" [completed]="stepsComplete.step3" *ngIf="paymentMethode.bankTransfer">
                <ng-template matStepLabel>Virement bancaire</ng-template>
                <div class="container" style="min-height: 500px;">
                    <mat-spinner style="margin:0 auto;" *ngIf="!paymentLink" mode="indeterminate">
                    </mat-spinner>
                    <iframe *ngIf="paymentLink" width="100%" height="500px" [src]="paymentLink" (load)="PaymentComplete()" #paymentFrame></iframe>
                </div>
            </mat-step>
            <mat-step [editable]="false" [completed]="stepsComplete.step4">
                <ng-template matStepLabel>Generation de la Facture</ng-template>
                <ng-template matStepContent>
                    <app-invoice [payment]="paymentMethode.bankTransfer ? 'bankTransfer' : 'PayWithDeleviry'">
                    </app-invoice>
                </ng-template>
            </mat-step>
        </mat-stepper>
    </div>
</div>

<div class="block-space block-space--layout--before-footer"></div>